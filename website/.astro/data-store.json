[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.4","content-config-digest","11a8b294d7377aec","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://varvedb.com\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","docs",["Map",11,12,41,42,71,72,112,113,147,148,179,180],"quick_start",{"id":11,"data":13,"body":16,"filePath":17,"digest":18,"rendered":19,"legacyId":40},{"title":14,"description":15},"Quick Start: Zero to Production","Get VarveDB running in your project in under 5 minutes.","Get VarveDB running in your Rust project in under 5 minutes. This guide will walk you through setting up a database, defining your schema, and persisting your first event.\n\n## 1. Installation\n\nAdd `varvedb` to your `Cargo.toml`. We also recommend `rkyv` for defining your event schema.\n\n```toml\n[dependencies]\nvarvedb = \"0.2.1\"\nrkyv = { version = \"0.8\", features = [\"bytecheck\", \"little_endian\"] }\ntempfile = \"3\" # Optional: mostly for tests/examples\n```\n\n## 2. define Your Schema\n\nVarveDB is schema-agnostic but relies on `rkyv` for zero-copy deserialization. Define your events as standard Rust structs.\n\n```rust\nuse rkyv::{Archive, Deserialize, Serialize};\n\n#[derive(Archive, Serialize, Deserialize, Debug)]\n#[rkyv(derive(Debug))]\n#[repr(C)]\nstruct InventoryEvent {\n    pub item_id: u32,\n    pub action: String, // e.g., \"StockAdded\"\n    pub quantity: u32,\n}\n```\n\n> [!NOTE]\n> `#[repr(C)]` and `#[rkyv(derive(Debug))]` are recommended for ensuring consistent memory layout and debugging capabilities for the zero-copy view.\n\n## 3. The \"Hello World\"\n\nHere is a complete, runnable example that opens a database, appends an event, and reads it back.\n\n```rust\nuse rkyv::{Archive, Deserialize, Serialize};\nuse varvedb::engine::{Reader, Writer};\nuse varvedb::storage::{Storage, StorageConfig};\nuse tempfile::tempdir;\n\n// 1. Define your Event (Schema)\n#[derive(Archive, Serialize, Deserialize, Debug)]\n#[rkyv(derive(Debug))]\n#[repr(C)]\nstruct InventoryEvent {\n    item_id: u32,\n    action: String,\n    quantity: u32,\n}\n\nfn main() -> Result\u003C(), Box\u003Cdyn std::error::Error>> {\n    // 2. Setup Configuration\n    // In a real app, use a persistent path like \"./data/db.mdb\"\n    let dir = tempdir()?; \n    let config = StorageConfig {\n        path: dir.path().join(\"inventory.mdb\"),\n        ..Default::default()\n    };\n\n    // 3. Initialize the Engine\n    // Storage handles the LMDB environment and background threads.\n    let storage = Storage::open(config)?;\n    let mut writer = Writer::new(storage.clone());\n\n    // 4. Append an Event\n    // We are creating a stream for Product #1 (stream_id=1)\n    // We expect this to be the 1st event in the stream (version=1)\n    let event = InventoryEvent {\n        item_id: 1,\n        action: \"StockAdded\".to_string(),\n        quantity: 100,\n    };\n    \n    // append(stream_id, expected_version, event)\n    let seq_num = writer.append(1, 1, event)?;\n    println!(\"Appended event with Global Sequence Number: {}\", seq_num);\n\n    // 5. Read it back\n    // The Reader provides zero-copy access to the data.\n    let reader = Reader::\u003CInventoryEvent>::new(storage.clone());\n    let txn = storage.env.read_txn()?;\n    \n    // Fetch by Global Sequence Number\n    if let Some(view) = reader.get(&txn, seq_num)? {\n        // 'view' is a zero-copy pointer to the data on disk.\n        // It behaves exactly like a reference to your struct.\n        println!(\"Read Event: {:?}\", view);\n        assert_eq!(view.quantity, 100);\n    }\n\n    Ok(())\n}\n```\n\n## Next Steps\n\nNow that you have the basics running, explore how to build real-world applications.\n\n*   [**Core Concepts**](/docs/concepts): Understand architecture, streams, and optimistic concurrency.\n*   [**User Guides**](/docs/guides): Learn how to handle migrations, concurrency, and backups.","src/content/docs/quick_start.md","253470cd8e416ceb",{"html":20,"metadata":21},"\u003Cp>Get VarveDB running in your Rust project in under 5 minutes. This guide will walk you through setting up a database, defining your schema, and persisting your first event.\u003C/p>\n\u003Ch2 id=\"1-installation\">1. Installation\u003C/h2>\n\u003Cp>Add \u003Ccode>varvedb\u003C/code> to your \u003Ccode>Cargo.toml\u003C/code>. We also recommend \u003Ccode>rkyv\u003C/code> for defining your event schema.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"toml\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#B392F0\">dependencies\u003C/span>\u003Cspan style=\"color:#E1E4E8\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">varvedb = \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"0.2.1\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">rkyv = { version = \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"0.8\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, features = [\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"bytecheck\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"little_endian\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">] }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">tempfile = \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"3\"\u003C/span>\u003Cspan style=\"color:#6A737D\"> # Optional: mostly for tests/examples\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"2-define-your-schema\">2. define Your Schema\u003C/h2>\n\u003Cp>VarveDB is schema-agnostic but relies on \u003Ccode>rkyv\u003C/code> for zero-copy deserialization. Define your events as standard Rust structs.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> rkyv\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003Cspan style=\"color:#B392F0\">Archive\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Deserialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Serialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[derive(\u003C/span>\u003Cspan style=\"color:#B392F0\">Archive\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Serialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Deserialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Debug\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[rkyv(derive(\u003C/span>\u003Cspan style=\"color:#B392F0\">Debug\u003C/span>\u003Cspan style=\"color:#E1E4E8\">))]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[repr(\u003C/span>\u003Cspan style=\"color:#B392F0\">C\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> InventoryEvent\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    pub\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item_id\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> u32\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    pub\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> action\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> String\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#6A737D\">// e.g., \"StockAdded\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    pub\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> quantity\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> u32\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>[!NOTE]\n\u003Ccode>#[repr(C)]\u003C/code> and \u003Ccode>#[rkyv(derive(Debug))]\u003C/code> are recommended for ensuring consistent memory layout and debugging capabilities for the zero-copy view.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"3-the-hello-world\">3. The “Hello World”\u003C/h2>\n\u003Cp>Here is a complete, runnable example that opens a database, appends an event, and reads it back.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> rkyv\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003Cspan style=\"color:#B392F0\">Archive\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Deserialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Serialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> varvedb\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">engine\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003Cspan style=\"color:#B392F0\">Reader\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Writer\u003C/span>\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> varvedb\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">storage\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003Cspan style=\"color:#B392F0\">Storage\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">StorageConfig\u003C/span>\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> tempfile\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">tempdir;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// 1. Define your Event (Schema)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[derive(\u003C/span>\u003Cspan style=\"color:#B392F0\">Archive\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Serialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Deserialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Debug\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[rkyv(derive(\u003C/span>\u003Cspan style=\"color:#B392F0\">Debug\u003C/span>\u003Cspan style=\"color:#E1E4E8\">))]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[repr(\u003C/span>\u003Cspan style=\"color:#B392F0\">C\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> InventoryEvent\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    item_id\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> u32\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    action\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> String\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    quantity\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> u32\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">fn\u003C/span>\u003Cspan style=\"color:#B392F0\"> main\u003C/span>\u003Cspan style=\"color:#E1E4E8\">() \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#B392F0\"> Result\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;(), \u003C/span>\u003Cspan style=\"color:#B392F0\">Box\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#F97583\">dyn\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> std\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">error\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // 2. Setup Configuration\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // In a real app, use a persistent path like \"./data/db.mdb\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> tempdir\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> config \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> StorageConfig\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        path\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> dir\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">path\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">join\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"inventory.mdb\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">        ..\u003C/span>\u003Cspan style=\"color:#B392F0\">Default\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">default\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // 3. Initialize the Engine\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // Storage handles the LMDB environment and background threads.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> storage \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> Storage\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">open\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(config)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#F97583\"> mut\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> writer \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> Writer\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">new\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(storage\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">clone\u003C/span>\u003Cspan style=\"color:#E1E4E8\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // 4. Append an Event\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // We are creating a stream for Product #1 (stream_id=1)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // We expect this to be the 1st event in the stream (version=1)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> event \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> InventoryEvent\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        item_id\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        action\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"StockAdded\"\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">to_string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        quantity\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 100\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // append(stream_id, expected_version, event)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> seq_num \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> writer\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">append\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, event)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">    println!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Appended event with Global Sequence Number: {}\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, seq_num);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // 5. Read it back\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // The Reader provides zero-copy access to the data.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> reader \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> Reader\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">InventoryEvent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">new\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(storage\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">clone\u003C/span>\u003Cspan style=\"color:#E1E4E8\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> txn \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> storage\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">env\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">read_txn\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // Fetch by Global Sequence Number\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    if\u003C/span>\u003Cspan style=\"color:#F97583\"> let\u003C/span>\u003Cspan style=\"color:#B392F0\"> Some\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(view) \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> reader\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">get\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#F97583\">&#x26;\u003C/span>\u003Cspan style=\"color:#E1E4E8\">txn, seq_num)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">        // 'view' is a zero-copy pointer to the data on disk.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">        // It behaves exactly like a reference to your struct.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        println!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Read Event: {:?}\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, view);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        assert_eq!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(view\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">quantity, \u003C/span>\u003Cspan style=\"color:#79B8FF\">100\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">    Ok\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"next-steps\">Next Steps\u003C/h2>\n\u003Cp>Now that you have the basics running, explore how to build real-world applications.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"/docs/concepts\">\u003Cstrong>Core Concepts\u003C/strong>\u003C/a>: Understand architecture, streams, and optimistic concurrency.\u003C/li>\n\u003Cli>\u003Ca href=\"/docs/guides\">\u003Cstrong>User Guides\u003C/strong>\u003C/a>: Learn how to handle migrations, concurrency, and backups.\u003C/li>\n\u003C/ul>",{"headings":22,"localImagePaths":36,"remoteImagePaths":37,"frontmatter":38,"imagePaths":39},[23,27,30,33],{"depth":24,"slug":25,"text":26},2,"1-installation","1. Installation",{"depth":24,"slug":28,"text":29},"2-define-your-schema","2. define Your Schema",{"depth":24,"slug":31,"text":32},"3-the-hello-world","3. The “Hello World”",{"depth":24,"slug":34,"text":35},"next-steps","Next Steps",[],[],{"title":14,"description":15},[],"quick_start.md","introduction",{"id":41,"data":43,"body":44,"filePath":45,"digest":46,"rendered":47,"legacyId":70},{},"> [!WARNING]\n> **UNDER DEVELOPMENT**: This project is currently in early development and is **NOT** production ready. APIs and storage formats are subject to change.\n\n# Introduction\n\n**VarveDB** is a high-performance, embedded, append-only event store for Rust. It provides a persistent, ACID-compliant event log optimized for high-throughput event sourcing applications.\n\nBuilt on **LMDB** (Lightning Memory-Mapped Database) and **rkyv**, VarveDB is designed for scenarios where performance and data integrity are paramount, offering zero-copy access to data and strict concurrency controls.\n\n## Key Features\n\n*   **Zero-Copy Access**: Events are mapped directly from disk to memory using [rkyv](https://rkyv.org/), eliminating deserialization overhead for read operations.\n*   **Optimistic Concurrency**: Writes are guarded by `ExpectedVersion`, allowing safe concurrent access without heavy locking.\n*   **Embedded Architecture**: Runs in-process with your application, removing the latency and operational complexity of external database servers.\n*   **Strongly Typed**: Enforce schema correctness at compile time with Rust types.\n*   **Reactive**: subscribe to changes in real-time using efficient `tokio::watch` channels.\n*   **Encryption**: Optional authenticated encryption (AES-256-GCM) ensures data is secure at rest without sacrificing the append-only nature.\n\n## Why VarveDB?\n\nTraditional databases often struggle with the specific requirements of event sourcing—immutable logs, global ordering, and replayability. External event stores like Kafka or EventStoreDB introduce network latency and operational overhead that may be unnecessary for reliable edge or single-node applications.\n\nVarveDB bridges this gap by providing:\n1.  **Speed**: By memory-mapping the database file, reading an event is as fast as reading a byte array from memory.\n2.  **Simplicity**: No external clusters to manage. Just include it as a crate.\n3.  **Safety**: ACID transactions ensure that your event log is never corrupted, even in the event of power failure.\n\n## Use Cases\n\n*   **Command Sourcing**: Store every state change in your application as an immutable sequence of events.\n*   **Audit Logging**: cryptographically verifiable logs for compliance and security.\n*   **Embedded Systems**: Efficient data storage for IoT devices where resources are constrained.\n*   **High-Frequency Data**: Capture market data or sensor readings with minimal latency.\n*   **Local-First Software**: Build offline-capable applications that sync when online, using the event log as the source of truth.\n\n## Core Concepts\n\n*   **Varve**: The main entry point to the database, handling transactions and coordination.\n*   **Event**: A user-defined struct containing domain data. Must be efficiently serializable via `rkyv`.\n*   **Metadata**: Sidecar information for an event (e.g., `StreamID`, timestamp, `UserID`).\n*   **Stream**: A logical sequence of events sharing a `StreamID`, ordered by version.\n*   **Processor**: A consumer that persistently tracks its position in the event log, ideal for building read models or projections.","src/content/docs/introduction.md","4f74081890a1afbe",{"html":48,"metadata":49},"\u003Cblockquote>\n\u003Cp>[!WARNING]\n\u003Cstrong>UNDER DEVELOPMENT\u003C/strong>: This project is currently in early development and is \u003Cstrong>NOT\u003C/strong> production ready. APIs and storage formats are subject to change.\u003C/p>\n\u003C/blockquote>\n\u003Ch1 id=\"introduction\">Introduction\u003C/h1>\n\u003Cp>\u003Cstrong>VarveDB\u003C/strong> is a high-performance, embedded, append-only event store for Rust. It provides a persistent, ACID-compliant event log optimized for high-throughput event sourcing applications.\u003C/p>\n\u003Cp>Built on \u003Cstrong>LMDB\u003C/strong> (Lightning Memory-Mapped Database) and \u003Cstrong>rkyv\u003C/strong>, VarveDB is designed for scenarios where performance and data integrity are paramount, offering zero-copy access to data and strict concurrency controls.\u003C/p>\n\u003Ch2 id=\"key-features\">Key Features\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>Zero-Copy Access\u003C/strong>: Events are mapped directly from disk to memory using \u003Ca href=\"https://rkyv.org/\">rkyv\u003C/a>, eliminating deserialization overhead for read operations.\u003C/li>\n\u003Cli>\u003Cstrong>Optimistic Concurrency\u003C/strong>: Writes are guarded by \u003Ccode>ExpectedVersion\u003C/code>, allowing safe concurrent access without heavy locking.\u003C/li>\n\u003Cli>\u003Cstrong>Embedded Architecture\u003C/strong>: Runs in-process with your application, removing the latency and operational complexity of external database servers.\u003C/li>\n\u003Cli>\u003Cstrong>Strongly Typed\u003C/strong>: Enforce schema correctness at compile time with Rust types.\u003C/li>\n\u003Cli>\u003Cstrong>Reactive\u003C/strong>: subscribe to changes in real-time using efficient \u003Ccode>tokio::watch\u003C/code> channels.\u003C/li>\n\u003Cli>\u003Cstrong>Encryption\u003C/strong>: Optional authenticated encryption (AES-256-GCM) ensures data is secure at rest without sacrificing the append-only nature.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"why-varvedb\">Why VarveDB?\u003C/h2>\n\u003Cp>Traditional databases often struggle with the specific requirements of event sourcing—immutable logs, global ordering, and replayability. External event stores like Kafka or EventStoreDB introduce network latency and operational overhead that may be unnecessary for reliable edge or single-node applications.\u003C/p>\n\u003Cp>VarveDB bridges this gap by providing:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Speed\u003C/strong>: By memory-mapping the database file, reading an event is as fast as reading a byte array from memory.\u003C/li>\n\u003Cli>\u003Cstrong>Simplicity\u003C/strong>: No external clusters to manage. Just include it as a crate.\u003C/li>\n\u003Cli>\u003Cstrong>Safety\u003C/strong>: ACID transactions ensure that your event log is never corrupted, even in the event of power failure.\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"use-cases\">Use Cases\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>Command Sourcing\u003C/strong>: Store every state change in your application as an immutable sequence of events.\u003C/li>\n\u003Cli>\u003Cstrong>Audit Logging\u003C/strong>: cryptographically verifiable logs for compliance and security.\u003C/li>\n\u003Cli>\u003Cstrong>Embedded Systems\u003C/strong>: Efficient data storage for IoT devices where resources are constrained.\u003C/li>\n\u003Cli>\u003Cstrong>High-Frequency Data\u003C/strong>: Capture market data or sensor readings with minimal latency.\u003C/li>\n\u003Cli>\u003Cstrong>Local-First Software\u003C/strong>: Build offline-capable applications that sync when online, using the event log as the source of truth.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"core-concepts\">Core Concepts\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>Varve\u003C/strong>: The main entry point to the database, handling transactions and coordination.\u003C/li>\n\u003Cli>\u003Cstrong>Event\u003C/strong>: A user-defined struct containing domain data. Must be efficiently serializable via \u003Ccode>rkyv\u003C/code>.\u003C/li>\n\u003Cli>\u003Cstrong>Metadata\u003C/strong>: Sidecar information for an event (e.g., \u003Ccode>StreamID\u003C/code>, timestamp, \u003Ccode>UserID\u003C/code>).\u003C/li>\n\u003Cli>\u003Cstrong>Stream\u003C/strong>: A logical sequence of events sharing a \u003Ccode>StreamID\u003C/code>, ordered by version.\u003C/li>\n\u003Cli>\u003Cstrong>Processor\u003C/strong>: A consumer that persistently tracks its position in the event log, ideal for building read models or projections.\u003C/li>\n\u003C/ul>",{"headings":50,"localImagePaths":66,"remoteImagePaths":67,"frontmatter":68,"imagePaths":69},[51,54,57,60,63],{"depth":52,"slug":41,"text":53},1,"Introduction",{"depth":24,"slug":55,"text":56},"key-features","Key Features",{"depth":24,"slug":58,"text":59},"why-varvedb","Why VarveDB?",{"depth":24,"slug":61,"text":62},"use-cases","Use Cases",{"depth":24,"slug":64,"text":65},"core-concepts","Core Concepts",[],[],{},[],"introduction.md","concepts",{"id":71,"data":73,"body":75,"filePath":76,"digest":77,"rendered":78,"legacyId":111},{"title":65,"description":74},"Understand the architecture, concurrency model, and data flow of VarveDB.","VarveDB is not a traditional relational database. It is an **embedded, append-only event store** designed for high-throughput event sourcing.\n\n## Architecture\n\nVarveDB is composed of three main persistent components, all backed by [LMDB](http://www.lmdb.tech/doc/) (via the `heed` crate):\n\n1.  **Events Log**: An append-only log accumulating all events in the system. Keys are global sequence members (u64).\n2.  **Stream Index**: A map optimizing lookups by Stream ID and Version.\n    *   `Key`: `[StreamID (128-bit)][Version (32-bit)]`\n    *   `Value`: `GlobalSequenceNumber (64-bit)`\n3.  **Blob Store**: A strictly content-addressed store for payloads larger than 1KB. This keeps the hot path (the log) small and cache-friendly.\n\n## The Data Model\n\n### Streams\nEvents are grouped into logical **Streams**. A stream represents the history of a single entity (e.g., a specific User, an Order, or a Product).\n*   **Stream ID**: `u128` (UUIDs fit perfectly).\n*   **Version**: `u32` monotonic counter within the stream (1, 2, 3...).\n\n### Events\nEvents are arbitrary Rust structs. We use [rkyv](https://rkyv.org/) to serialize them. This allows **Zero-Copy Deserialization**, meaning we can read an event from the OS page cache without allocating heap memory for it.\n\n```rust\n// Your event is just a struct!\n#[derive(Archive, Serialize, Deserialize)]\nstruct OrderPlaced {\n    amount: u32,\n    currency: String,\n}\n```\n\n## Consistency & Concurrency\n\nVarveDB guarantees **Strict Ordering** within a stream. To handle concurrent writes, it uses **Optimistic Concurrency Control (OCC)** via the `ExpectedVersion` enum.\n\nWhen you append an event, you must state what version you expect the stream to be at:\n\n*   **`ExpectedVersion::Exact(n)`**: \"I believe the last event was version `n`. This new one should be `n+1`.\"\n    *   If the current version is not `n`, the write fails with `ConcurrencyConflict`.\n    *   **Use Case**: Critical logic (e.g., checking bank balance before withdrawal).\n*   **`ExpectedVersion::Auto`**: \"I don't care about the order, just put it at the end.\"\n    *   **Use Case**: Logging, IoT sensor data where order matters less than throughput.\n\n## Zero-Copy & Encryption\n\n### Zero-Copy (Default)\nWhen encryption is **disabled**, reading an event returns a reference to the memory-mapped file. Accessing fields is as fast as accessing raw memory.\n\n### Authenticated Encryption (Optional)\nWhen enabled, each stream has its own AES-256-GCM key.\n*   **AAD Binding**: The Stream ID and Sequence Number are bound to the ciphertext. You cannot copy an encrypted event from Stream A to Stream B, nor can you replay an old event; validation will fail.\n*   **Trade-off**: Encryption disables Zero-Copy. Data must be decrypted into a temporary buffer.","src/content/docs/concepts.md","485b1564a607f8d5",{"html":79,"metadata":80},"\u003Cp>VarveDB is not a traditional relational database. It is an \u003Cstrong>embedded, append-only event store\u003C/strong> designed for high-throughput event sourcing.\u003C/p>\n\u003Ch2 id=\"architecture\">Architecture\u003C/h2>\n\u003Cp>VarveDB is composed of three main persistent components, all backed by \u003Ca href=\"http://www.lmdb.tech/doc/\">LMDB\u003C/a> (via the \u003Ccode>heed\u003C/code> crate):\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Events Log\u003C/strong>: An append-only log accumulating all events in the system. Keys are global sequence members (u64).\u003C/li>\n\u003Cli>\u003Cstrong>Stream Index\u003C/strong>: A map optimizing lookups by Stream ID and Version.\n\u003Cul>\n\u003Cli>\u003Ccode>Key\u003C/code>: \u003Ccode>[StreamID (128-bit)][Version (32-bit)]\u003C/code>\u003C/li>\n\u003Cli>\u003Ccode>Value\u003C/code>: \u003Ccode>GlobalSequenceNumber (64-bit)\u003C/code>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Cstrong>Blob Store\u003C/strong>: A strictly content-addressed store for payloads larger than 1KB. This keeps the hot path (the log) small and cache-friendly.\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"the-data-model\">The Data Model\u003C/h2>\n\u003Ch3 id=\"streams\">Streams\u003C/h3>\n\u003Cp>Events are grouped into logical \u003Cstrong>Streams\u003C/strong>. A stream represents the history of a single entity (e.g., a specific User, an Order, or a Product).\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Stream ID\u003C/strong>: \u003Ccode>u128\u003C/code> (UUIDs fit perfectly).\u003C/li>\n\u003Cli>\u003Cstrong>Version\u003C/strong>: \u003Ccode>u32\u003C/code> monotonic counter within the stream (1, 2, 3…).\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"events\">Events\u003C/h3>\n\u003Cp>Events are arbitrary Rust structs. We use \u003Ca href=\"https://rkyv.org/\">rkyv\u003C/a> to serialize them. This allows \u003Cstrong>Zero-Copy Deserialization\u003C/strong>, meaning we can read an event from the OS page cache without allocating heap memory for it.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// Your event is just a struct!\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#[derive(\u003C/span>\u003Cspan style=\"color:#B392F0\">Archive\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Serialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">Deserialize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> OrderPlaced\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    amount\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> u32\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    currency\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> String\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"consistency--concurrency\">Consistency &#x26; Concurrency\u003C/h2>\n\u003Cp>VarveDB guarantees \u003Cstrong>Strict Ordering\u003C/strong> within a stream. To handle concurrent writes, it uses \u003Cstrong>Optimistic Concurrency Control (OCC)\u003C/strong> via the \u003Ccode>ExpectedVersion\u003C/code> enum.\u003C/p>\n\u003Cp>When you append an event, you must state what version you expect the stream to be at:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>\u003Ccode>ExpectedVersion::Exact(n)\u003C/code>\u003C/strong>: “I believe the last event was version \u003Ccode>n\u003C/code>. This new one should be \u003Ccode>n+1\u003C/code>.”\n\u003Cul>\n\u003Cli>If the current version is not \u003Ccode>n\u003C/code>, the write fails with \u003Ccode>ConcurrencyConflict\u003C/code>.\u003C/li>\n\u003Cli>\u003Cstrong>Use Case\u003C/strong>: Critical logic (e.g., checking bank balance before withdrawal).\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Cstrong>\u003Ccode>ExpectedVersion::Auto\u003C/code>\u003C/strong>: “I don’t care about the order, just put it at the end.”\n\u003Cul>\n\u003Cli>\u003Cstrong>Use Case\u003C/strong>: Logging, IoT sensor data where order matters less than throughput.\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"zero-copy--encryption\">Zero-Copy &#x26; Encryption\u003C/h2>\n\u003Ch3 id=\"zero-copy-default\">Zero-Copy (Default)\u003C/h3>\n\u003Cp>When encryption is \u003Cstrong>disabled\u003C/strong>, reading an event returns a reference to the memory-mapped file. Accessing fields is as fast as accessing raw memory.\u003C/p>\n\u003Ch3 id=\"authenticated-encryption-optional\">Authenticated Encryption (Optional)\u003C/h3>\n\u003Cp>When enabled, each stream has its own AES-256-GCM key.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>AAD Binding\u003C/strong>: The Stream ID and Sequence Number are bound to the ciphertext. You cannot copy an encrypted event from Stream A to Stream B, nor can you replay an old event; validation will fail.\u003C/li>\n\u003Cli>\u003Cstrong>Trade-off\u003C/strong>: Encryption disables Zero-Copy. Data must be decrypted into a temporary buffer.\u003C/li>\n\u003C/ul>",{"headings":81,"localImagePaths":107,"remoteImagePaths":108,"frontmatter":109,"imagePaths":110},[82,85,88,92,95,98,101,104],{"depth":24,"slug":83,"text":84},"architecture","Architecture",{"depth":24,"slug":86,"text":87},"the-data-model","The Data Model",{"depth":89,"slug":90,"text":91},3,"streams","Streams",{"depth":89,"slug":93,"text":94},"events","Events",{"depth":24,"slug":96,"text":97},"consistency--concurrency","Consistency & Concurrency",{"depth":24,"slug":99,"text":100},"zero-copy--encryption","Zero-Copy & Encryption",{"depth":89,"slug":102,"text":103},"zero-copy-default","Zero-Copy (Default)",{"depth":89,"slug":105,"text":106},"authenticated-encryption-optional","Authenticated Encryption (Optional)",[],[],{"title":65,"description":74},[],"concepts.md","performance",{"id":112,"data":114,"body":115,"filePath":116,"digest":117,"rendered":118,"legacyId":146},{},"# Performance\n\nVarveDB is designed to be as fast as possible while maintaining strong consistency guarantees.\n\n## Benchmarks\n\n*Hardware: MacBook Pro M2, NVMe SSD*\n\n| Operation | Throughput | Latency (p99) |\n| :--- | :--- | :--- |\n| **Append** (1KB Event) | ~60,000 ops/sec | ~1.2 ms |\n| **Read** (Random Access) | ~800,000 ops/sec | \u003C 0.1 ms |\n| **Sequential Scan** | ~1.5 M ops/sec | \u003C 0.05 ms |\n\n> Note: These numbers are indicative and depend heavily on hardware, specifically disk IOPS for writes and RAM speed for reads.\n\n## Design Trade-offs\n\n### Memory Usage\nSince VarveDB uses memory-mapped files, the operating system manages memory usage. Your process might appear to use a lot of virtual memory, but physical RAM usage is dynamic. The OS will evict pages from the cache as needed.\n*   **Tip**: Ensure your dataset fits reasonably within available RAM for optimal read performance.\n\n### Write Amplification\nLMDB uses a copy-on-write B-tree. This provides safety but can cause write amplification.\n*   **Tip**: Use batching if you need to ingest millions of events quickly (batch API coming soon).\n\n### Storage Space\n`rkyv` is a binary format and is generally compact, but it prioritizes alignment for zero-copy access over compression.\n*   **Tip**: If you store large strings or blobs, consider compressing them *before* putting them into your event struct if storage space is a primary concern.\n\n## Hardware Recommendations\n\n1.  **Storage**: **NVMe SSD** is highly recommended. Appending to the log requires frequent `fsync` calls (unless `Async` durability is chosen). HDD performance will be significantly lower.\n2.  **Memory**: More RAM = more OS page cache = faster reads.\n3.  **CPU**: Serialization is rarely the bottleneck due to `rkyv`. CPU is mostly used for hashing (indexes) and encryption (if enabled).","src/content/docs/performance.md","59c8ca2cee0a0d1a",{"html":119,"metadata":120},"\u003Ch1 id=\"performance\">Performance\u003C/h1>\n\u003Cp>VarveDB is designed to be as fast as possible while maintaining strong consistency guarantees.\u003C/p>\n\u003Ch2 id=\"benchmarks\">Benchmarks\u003C/h2>\n\u003Cp>\u003Cem>Hardware: MacBook Pro M2, NVMe SSD\u003C/em>\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth align=\"left\">Operation\u003C/th>\u003Cth align=\"left\">Throughput\u003C/th>\u003Cth align=\"left\">Latency (p99)\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd align=\"left\">\u003Cstrong>Append\u003C/strong> (1KB Event)\u003C/td>\u003Ctd align=\"left\">~60,000 ops/sec\u003C/td>\u003Ctd align=\"left\">~1.2 ms\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"left\">\u003Cstrong>Read\u003C/strong> (Random Access)\u003C/td>\u003Ctd align=\"left\">~800,000 ops/sec\u003C/td>\u003Ctd align=\"left\">&#x3C; 0.1 ms\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"left\">\u003Cstrong>Sequential Scan\u003C/strong>\u003C/td>\u003Ctd align=\"left\">~1.5 M ops/sec\u003C/td>\u003Ctd align=\"left\">&#x3C; 0.05 ms\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cblockquote>\n\u003Cp>Note: These numbers are indicative and depend heavily on hardware, specifically disk IOPS for writes and RAM speed for reads.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"design-trade-offs\">Design Trade-offs\u003C/h2>\n\u003Ch3 id=\"memory-usage\">Memory Usage\u003C/h3>\n\u003Cp>Since VarveDB uses memory-mapped files, the operating system manages memory usage. Your process might appear to use a lot of virtual memory, but physical RAM usage is dynamic. The OS will evict pages from the cache as needed.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Tip\u003C/strong>: Ensure your dataset fits reasonably within available RAM for optimal read performance.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"write-amplification\">Write Amplification\u003C/h3>\n\u003Cp>LMDB uses a copy-on-write B-tree. This provides safety but can cause write amplification.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Tip\u003C/strong>: Use batching if you need to ingest millions of events quickly (batch API coming soon).\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"storage-space\">Storage Space\u003C/h3>\n\u003Cp>\u003Ccode>rkyv\u003C/code> is a binary format and is generally compact, but it prioritizes alignment for zero-copy access over compression.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Tip\u003C/strong>: If you store large strings or blobs, consider compressing them \u003Cem>before\u003C/em> putting them into your event struct if storage space is a primary concern.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"hardware-recommendations\">Hardware Recommendations\u003C/h2>\n\u003Col>\n\u003Cli>\u003Cstrong>Storage\u003C/strong>: \u003Cstrong>NVMe SSD\u003C/strong> is highly recommended. Appending to the log requires frequent \u003Ccode>fsync\u003C/code> calls (unless \u003Ccode>Async\u003C/code> durability is chosen). HDD performance will be significantly lower.\u003C/li>\n\u003Cli>\u003Cstrong>Memory\u003C/strong>: More RAM = more OS page cache = faster reads.\u003C/li>\n\u003Cli>\u003Cstrong>CPU\u003C/strong>: Serialization is rarely the bottleneck due to \u003Ccode>rkyv\u003C/code>. CPU is mostly used for hashing (indexes) and encryption (if enabled).\u003C/li>\n\u003C/ol>",{"headings":121,"localImagePaths":142,"remoteImagePaths":143,"frontmatter":144,"imagePaths":145},[122,124,127,130,133,136,139],{"depth":52,"slug":112,"text":123},"Performance",{"depth":24,"slug":125,"text":126},"benchmarks","Benchmarks",{"depth":24,"slug":128,"text":129},"design-trade-offs","Design Trade-offs",{"depth":89,"slug":131,"text":132},"memory-usage","Memory Usage",{"depth":89,"slug":134,"text":135},"write-amplification","Write Amplification",{"depth":89,"slug":137,"text":138},"storage-space","Storage Space",{"depth":24,"slug":140,"text":141},"hardware-recommendations","Hardware Recommendations",[],[],{},[],"performance.md","guides/concurrency",{"id":147,"data":149,"body":152,"filePath":153,"digest":154,"rendered":155,"legacyId":178},{"title":150,"description":151},"Handling Concurrency","How to use Optimistic Concurrency Control to prevent race conditions.","In a distributed system, multiple processes often try to modify the same entity simultaneously. Without protection, this leads to **Race Conditions**.\n\n## The Scenario: Overselling Inventory\n\nImagine an E-commerce system.\n1.  **Product A** has 1 item left in stock.\n2.  **User 1** adds it to cart vs **User 2** adds it to cart.\n3.  Both check stock -> Both see \"1 item\".\n4.  Both checkout -> **Both buy it.**\n5.  Result: **-1 Stock** (Overselling).\n\n## The Solution: ExpectedVersion\n\nVarveDB solves this with **Optimistic Concurrency Control (OCC)**. You don't lock the table (pessimistic); instead, you \"optimistically\" assume you are the only one writing, but you enforce a check at the moment of writing.\n\n### Step 1: Read the current state\nFirst, you must read the stream to know its current version.\n\n```rust\n// Assume we have replayed the stream and know:\nlet current_version = 10;\nlet current_stock = 1;\n```\n\n### Step 2: Attempt to Write with `ExpectedVersion::Exact`\n\nWhen you append the \"StockReserved\" event, you **must** specify that you expect the stream to be at version 10.\n\n```rust\nlet event = InventoryEvent {\n    item_id: 1,\n    action: \"StockReserved\".to_string(),\n    quantity: 1,\n};\n\n// We explicitly state: \"This append is only valid if the stream is currently at version 10\"\n// The new event will be version 11.\nlet result = writer.append(1, ExpectedVersion::Exact(current_version), event);\n```\n\n### Step 3: Handle the Conflict\n\nIf User 2 beat User 1 by milliseconds, the stream version will already be 11. User 1's write (expecting 10) will fail.\n\n```rust\nmatch result {\n    Ok(seq) => println!(\"Success! Stock reserved.\"),\n    Err(varvedb::Error::ConcurrencyConflict { stream_id, version }) => {\n        // The version changed under our feet!\n        // 1. Re-read the stream to get the new state (maybe stock is now 0).\n        // 2. Retry the operation or inform the user.\n        println!(\"Conflict! Someone else modified the stream.\");\n    }\n    Err(e) => eprintln!(\"System error: {}\", e),\n}\n```\n\nThis pattern ensures that **event history is linear and consistent** without requiring heavy database locks.","src/content/docs/guides/concurrency.md","eb5d4d0c4186cb05",{"html":156,"metadata":157},"\u003Cp>In a distributed system, multiple processes often try to modify the same entity simultaneously. Without protection, this leads to \u003Cstrong>Race Conditions\u003C/strong>.\u003C/p>\n\u003Ch2 id=\"the-scenario-overselling-inventory\">The Scenario: Overselling Inventory\u003C/h2>\n\u003Cp>Imagine an E-commerce system.\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Product A\u003C/strong> has 1 item left in stock.\u003C/li>\n\u003Cli>\u003Cstrong>User 1\u003C/strong> adds it to cart vs \u003Cstrong>User 2\u003C/strong> adds it to cart.\u003C/li>\n\u003Cli>Both check stock -> Both see “1 item”.\u003C/li>\n\u003Cli>Both checkout -> \u003Cstrong>Both buy it.\u003C/strong>\u003C/li>\n\u003Cli>Result: \u003Cstrong>-1 Stock\u003C/strong> (Overselling).\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"the-solution-expectedversion\">The Solution: ExpectedVersion\u003C/h2>\n\u003Cp>VarveDB solves this with \u003Cstrong>Optimistic Concurrency Control (OCC)\u003C/strong>. You don’t lock the table (pessimistic); instead, you “optimistically” assume you are the only one writing, but you enforce a check at the moment of writing.\u003C/p>\n\u003Ch3 id=\"step-1-read-the-current-state\">Step 1: Read the current state\u003C/h3>\n\u003Cp>First, you must read the stream to know its current version.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// Assume we have replayed the stream and know:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> current_version \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 10\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> current_stock \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-2-attempt-to-write-with-expectedversionexact\">Step 2: Attempt to Write with \u003Ccode>ExpectedVersion::Exact\u003C/code>\u003C/h3>\n\u003Cp>When you append the “StockReserved” event, you \u003Cstrong>must\u003C/strong> specify that you expect the stream to be at version 10.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> event \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> InventoryEvent\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    item_id\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    action\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"StockReserved\"\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">to_string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    quantity\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// We explicitly state: \"This append is only valid if the stream is currently at version 10\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// The new event will be version 11.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> result \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> writer\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">append\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">ExpectedVersion\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">Exact\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(current_version), event);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-3-handle-the-conflict\">Step 3: Handle the Conflict\u003C/h3>\n\u003Cp>If User 2 beat User 1 by milliseconds, the stream version will already be 11. User 1’s write (expecting 10) will fail.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">match\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> result {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">    Ok\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(seq) \u003C/span>\u003Cspan style=\"color:#F97583\">=>\u003C/span>\u003Cspan style=\"color:#B392F0\"> println!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Success! Stock reserved.\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">    Err\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">varvedb\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">Error\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">ConcurrencyConflict\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { stream_id, version }) \u003C/span>\u003Cspan style=\"color:#F97583\">=>\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">        // The version changed under our feet!\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">        // 1. Re-read the stream to get the new state (maybe stock is now 0).\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">        // 2. Retry the operation or inform the user.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        println!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Conflict! Someone else modified the stream.\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">    Err\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(e) \u003C/span>\u003Cspan style=\"color:#F97583\">=>\u003C/span>\u003Cspan style=\"color:#B392F0\"> eprintln!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"System error: {}\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, e),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This pattern ensures that \u003Cstrong>event history is linear and consistent\u003C/strong> without requiring heavy database locks.\u003C/p>",{"headings":158,"localImagePaths":174,"remoteImagePaths":175,"frontmatter":176,"imagePaths":177},[159,162,165,168,171],{"depth":24,"slug":160,"text":161},"the-scenario-overselling-inventory","The Scenario: Overselling Inventory",{"depth":24,"slug":163,"text":164},"the-solution-expectedversion","The Solution: ExpectedVersion",{"depth":89,"slug":166,"text":167},"step-1-read-the-current-state","Step 1: Read the current state",{"depth":89,"slug":169,"text":170},"step-2-attempt-to-write-with-expectedversionexact","Step 2: Attempt to Write with ExpectedVersion::Exact",{"depth":89,"slug":172,"text":173},"step-3-handle-the-conflict","Step 3: Handle the Conflict",[],[],{"title":150,"description":151},[],"guides/concurrency.md","guides/processing",{"id":179,"data":181,"body":183,"filePath":184,"digest":185,"rendered":186,"legacyId":206},{"title":182},"Event Processing","The real power of an event store comes from consuming events to build read models, trigger external actions, or drive workflows. VarveDB provides a robust **Processor** framework for this.\n\n## The Processor Pattern\n\nA **Processor** in VarveDB is a background task that:\n1.  Subscribes to the event log.\n2.  Reads new events sequentially.\n3.  Handles them (updates state, sends emails, etc.).\n4.  **Checkpoints** its position.\n\nIf the application restarts, the Processor resumes exactly where it left off, ensuring **at-least-once** processing.\n\n## Implementing a Handler\n\nTo create a processor, implement the `EventHandler` trait for your event type.\n\n```rust\nuse varvedb::processor::EventHandler;\n\nstruct MyProjection {\n    // Local state, e.g., a HashMap or a connection to a SQL DB\n}\n\nimpl EventHandler\u003CMyEvent> for MyProjection {\n    fn handle(&mut self, event: &MyEvent::Archived) -> varvedb::Result\u003C()> {\n        match event {\n            // Apply logic based on the event\n            _ => println!(\"Handled event\"),\n        }\n        Ok(())\n    }\n}\n```\n\n## Running the Processor\n\nUse the `Processor` struct to run your handler.\n\n```rust\nuse varvedb::processor::Processor;\n\n// ... inside async main ...\n\nlet projection = MyProjection { ... };\nlet consumer_id = 100; // Unique ID for this processor to track its cursor\n\nlet mut processor = Processor::new(&varve, projection, consumer_id);\n\n// Run in a background task\ntokio::spawn(async move {\n    processor.run().await.unwrap();\n});\n```\n\n## Consumer Groups (Scaling)\n\nCurrently, VarveDB supports single-consumer processing per `consumer_id`. To scale processing (competing consumers), you would typically use an external message broker or partition your streams, but native support for competing consumers is on the roadmap.","src/content/docs/guides/processing.md","cf059093294d9bb0",{"html":187,"metadata":188},"\u003Cp>The real power of an event store comes from consuming events to build read models, trigger external actions, or drive workflows. VarveDB provides a robust \u003Cstrong>Processor\u003C/strong> framework for this.\u003C/p>\n\u003Ch2 id=\"the-processor-pattern\">The Processor Pattern\u003C/h2>\n\u003Cp>A \u003Cstrong>Processor\u003C/strong> in VarveDB is a background task that:\u003C/p>\n\u003Col>\n\u003Cli>Subscribes to the event log.\u003C/li>\n\u003Cli>Reads new events sequentially.\u003C/li>\n\u003Cli>Handles them (updates state, sends emails, etc.).\u003C/li>\n\u003Cli>\u003Cstrong>Checkpoints\u003C/strong> its position.\u003C/li>\n\u003C/ol>\n\u003Cp>If the application restarts, the Processor resumes exactly where it left off, ensuring \u003Cstrong>at-least-once\u003C/strong> processing.\u003C/p>\n\u003Ch2 id=\"implementing-a-handler\">Implementing a Handler\u003C/h2>\n\u003Cp>To create a processor, implement the \u003Ccode>EventHandler\u003C/code> trait for your event type.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> varvedb\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">processor\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">EventHandler\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> MyProjection\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // Local state, e.g., a HashMap or a connection to a SQL DB\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">impl\u003C/span>\u003Cspan style=\"color:#B392F0\"> EventHandler\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">MyEvent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">> \u003C/span>\u003Cspan style=\"color:#F97583\">for\u003C/span>\u003Cspan style=\"color:#B392F0\"> MyProjection\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    fn\u003C/span>\u003Cspan style=\"color:#B392F0\"> handle\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#F97583\">&#x26;mut\u003C/span>\u003Cspan style=\"color:#79B8FF\"> self\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, event\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#F97583\"> &#x26;\u003C/span>\u003Cspan style=\"color:#B392F0\">MyEvent\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">Archived\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#B392F0\"> varvedb\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">Result\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;()> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">        match\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> event {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">            // Apply logic based on the event\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            _ \u003C/span>\u003Cspan style=\"color:#F97583\">=>\u003C/span>\u003Cspan style=\"color:#B392F0\"> println!\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Handled event\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        Ok\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"running-the-processor\">Running the Processor\u003C/h2>\n\u003Cp>Use the \u003Ccode>Processor\u003C/code> struct to run your handler.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">use\u003C/span>\u003Cspan style=\"color:#B392F0\"> varvedb\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">processor\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">Processor\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// ... inside async main ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> projection \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> MyProjection\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#F97583\">...\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> consumer_id \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 100\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#6A737D\">// Unique ID for this processor to track its cursor\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">let\u003C/span>\u003Cspan style=\"color:#F97583\"> mut\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> processor \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> Processor\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">new\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#F97583\">&#x26;\u003C/span>\u003Cspan style=\"color:#E1E4E8\">varve, projection, consumer_id);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// Run in a background task\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">tokio\u003C/span>\u003Cspan style=\"color:#F97583\">::\u003C/span>\u003Cspan style=\"color:#B392F0\">spawn\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#F97583\">async\u003C/span>\u003Cspan style=\"color:#F97583\"> move\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    processor\u003C/span>\u003Cspan style=\"color:#F97583\">.\u003C/span>\u003Cspan style=\"color:#B392F0\">run\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003Cspan style=\"color:#F97583\">.await.\u003C/span>\u003Cspan style=\"color:#B392F0\">unwrap\u003C/span>\u003Cspan style=\"color:#E1E4E8\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"consumer-groups-scaling\">Consumer Groups (Scaling)\u003C/h2>\n\u003Cp>Currently, VarveDB supports single-consumer processing per \u003Ccode>consumer_id\u003C/code>. To scale processing (competing consumers), you would typically use an external message broker or partition your streams, but native support for competing consumers is on the roadmap.\u003C/p>",{"headings":189,"localImagePaths":202,"remoteImagePaths":203,"frontmatter":204,"imagePaths":205},[190,193,196,199],{"depth":24,"slug":191,"text":192},"the-processor-pattern","The Processor Pattern",{"depth":24,"slug":194,"text":195},"implementing-a-handler","Implementing a Handler",{"depth":24,"slug":197,"text":198},"running-the-processor","Running the Processor",{"depth":24,"slug":200,"text":201},"consumer-groups-scaling","Consumer Groups (Scaling)",[],[],{"title":182},[],"guides/processing.md"]